---
title: "PISA Belonging Scale"
author: "Alex"
date: "15/02/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE)
library(data.table)
library(GAabbreviate)
library(ggplot2)
library(reticulate)
```

```{python readPisa}

# Uses the PISA 2018 Data

import pandas as pd
from scripts.data_pre_process.extract_pisa_data import read_pisa_data

pisa_belong_data = read_pisa_data()

#pisa_belong_data = pd.concat(map(read_pisa_data, ["Australia", "United Kingdom"]))

```

```{r pisaR}
pisa_belong_data <-
  as.data.table(py$pisa_belong_data)

pisa_belong_data <-
  na.omit(pisa_belong_data)

pisa_belong_data[, index := 1:nrow(.SD)]

pisa_long <-
  melt(pisa_belong_data,
       id.vars = c("index", "country"),
       variable.name = "item",
       value.name = "response")

ggplot(pisa_long, aes(x = response)) +
  stat_count() +
  facet_wrap(~item)
```

# Results

## Item Analysis


## Factor Analysis

```{r, results=F}

pisa_belong_mat <- psych::reverse.code(
  keys=c(1,-1,-1,1,-1,1),
  items=pisa_belong_data[,2:7]
  )

colnames(pisa_belong_mat) <- NULL

scales <-
  apply(pisa_belong_mat, 1, sum)

pisa_ga_output <-
  GAabbreviate(
    items = pisa_belong_mat,
    scales = scales, 
    itemCost = 0.05, 
    maxItems = 1,
    popSize = 200,
    maxiter = 500,
    run = 200,
    verbose = F)

plot(pisa_ga_output)

```



